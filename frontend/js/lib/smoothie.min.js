(function(e){Date.now=Date.now||function(){return(new Date).getTime()};var n={extend:function(){arguments[0]=arguments[0]||{};for(var e,t=1;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&(typeof arguments[t][e]=="object"?arguments[t][e]instanceof Array?arguments[0][e]=arguments[t][e]:arguments[0][e]=n.extend(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]},binarySearch:function(e,t){for(var s,n=0,o=e.length;n<o;)s=n+o>>1,t<e[s][0]?o=s:n=s+1;return n},pixelSnap:function(e,t){return t%2===0?Math.round(e):Math.floor(e)+.5}};function s(e){this.options=n.extend({},s.defaultOptions,e),this.disabled=!1,this.clear()}s.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},s.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},s.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var e,t=1;t<this.data.length;t++)e=this.data[t][1],e>this.maxValue&&(this.maxValue=e),e<this.minValue&&(this.minValue=e)}else this.maxValue=Number.NaN,this.minValue=Number.NaN},s.prototype.append=function(e,t,n){if(isNaN(e)||isNaN(t))return;var s,o,i=this.data.length-1;if(i>=0){for(o=i;!0;){if(s=this.data[o],e>=s[0]){e===s[0]?n?(s[1]+=t,t=s[1]):s[1]=t:this.data.splice(o+1,0,[e,t]);break}if(o--,o<0){this.data.splice(0,0,[e,t]);break}}}else this.data.push([e,t]);this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t),this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)},s.prototype.dropOldData=function(e,t){for(var n=0;this.data.length-n>=t&&this.data[n+1][0]<e;)n++;n!==0&&this.data.splice(0,n)};function t(e){this.options=n.extend({},t.defaultChartOptions,e),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}t.tooltipFormatter=function(e,n){var s,o,a,r=this.options.timestampFormatter||t.timeFormatter,i=document.createElement("div");i.appendChild(document.createTextNode(r(new Date(e))));for(s=0;s<n.length;++s)o=n[s].series.options.tooltipLabel||"",o!==""&&(o=o+" "),a=document.createElement("span"),a.style.color=n[s].series.options.strokeStyle,a.appendChild(document.createTextNode(o+this.options.yMaxFormatter(n[s].value,this.options.labels.precision))),i.appendChild(document.createElement("br")),i.appendChild(a);return i.innerHTML},t.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(e,t){return parseFloat(e).toFixed(t)},yMaxFormatter:function(e,t){return parseFloat(e).toFixed(t)},yIntermediateFormatter:function(e,t){return parseFloat(e).toFixed(t)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:2,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},title:{text:"",fillStyle:"#ffffff",fontSize:15,fontFamily:"monospace",verticalAlign:"middle"},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:t.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},t.AnimateCompatibility=function(){var e=function(e,t){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(function(){e(Date.now())},16)};return n.call(window,e,t)},t=function(e){var t=window.cancelAnimationFrame||function(e){clearTimeout(e)};return t.call(window,e)};return{requestAnimationFrame:e,cancelAnimationFrame:t}}(),t.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff",fillToBottom:!0},t.prototype.addTimeSeries=function(e,s){this.seriesSet.push({timeSeries:e,options:n.extend({},t.defaultSeriesPresentationOptions,s)}),e.options.resetBounds&&e.options.resetBoundsInterval>0&&(e.resetBoundsTimerId=setInterval(function(){e.resetBounds()},e.options.resetBoundsInterval))},t.prototype.removeTimeSeries=function(e){for(var n=this.seriesSet.length,t=0;t<n;t++)if(this.seriesSet[t].timeSeries===e){this.seriesSet.splice(t,1);break}e.resetBoundsTimerId&&clearInterval(e.resetBoundsTimerId)},t.prototype.getTimeSeriesOptions=function(e){for(var n=this.seriesSet.length,t=0;t<n;t++)if(this.seriesSet[t].timeSeries===e)return this.seriesSet[t].options},t.prototype.bringToFront=function(e){for(var n,s=this.seriesSet.length,t=0;t<s;t++)if(this.seriesSet[t].timeSeries===e){n=this.seriesSet.splice(t,1),this.seriesSet.push(n[0]);break}},t.prototype.streamTo=function(e,t){this.canvas=e,this.clientWidth=parseInt(this.canvas.getAttribute("width")),this.clientHeight=parseInt(this.canvas.getAttribute("height")),this.delay=t,this.start()},t.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.pointerEvents="none",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},t.prototype.updateTooltip=function(){if(!this.options.tooltip)return;var e,t,s,i,a,r,o=this.getTooltipEl();if(!this.mouseover||!this.options.tooltip){o.style.display="none";return}for(a=this.lastChartTimestamp,r=this.options.scrollBackwards?a-this.mouseX*this.options.millisPerPixel:a-(this.clientWidth-this.mouseX)*this.options.millisPerPixel,i=[],e=0;e<this.seriesSet.length;e++){if(t=this.seriesSet[e].timeSeries,t.disabled)continue;s=n.binarySearch(t.data,r),s>0&&s<t.data.length&&i.push({series:this.seriesSet[e],index:s,value:t.data[s][1]})}i.length?(o.innerHTML=this.options.tooltipFormatter.call(this,r,i),o.style.display="block"):o.style.display="none"},t.prototype.mousemove=function(e){if(this.mouseover=!0,this.mouseX=e.offsetX,this.mouseY=e.offsetY,this.mousePageX=e.pageX,this.mousePageY=e.pageY,!this.options.tooltip)return;var t=this.getTooltipEl();t.style.top=Math.round(this.mousePageY)+"px",t.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()},t.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},t.prototype.resize=function(){var t,n,e=!this.options.enableDpiScaling||!window?1:window.devicePixelRatio;this.options.responsive?(t=this.canvas.offsetWidth,n=this.canvas.offsetHeight,t!==this.lastWidth&&(this.lastWidth=t,this.canvas.setAttribute("width",Math.floor(t*e).toString()),this.canvas.getContext("2d").scale(e,e)),n!==this.lastHeight&&(this.lastHeight=n,this.canvas.setAttribute("height",Math.floor(n*e).toString()),this.canvas.getContext("2d").scale(e,e)),this.clientWidth=t,this.clientHeight=n):(t=parseInt(this.canvas.getAttribute("width")),n=parseInt(this.canvas.getAttribute("height")),e!==1?(Math.floor(this.clientWidth*e)!==t&&(this.canvas.setAttribute("width",Math.floor(t*e).toString()),this.canvas.style.width=t+"px",this.clientWidth=t,this.canvas.getContext("2d").scale(e,e)),Math.floor(this.clientHeight*e)!==n&&(this.canvas.setAttribute("height",Math.floor(n*e).toString()),this.canvas.style.height=n+"px",this.clientHeight=n,this.canvas.getContext("2d").scale(e,e))):(this.clientWidth=t,this.clientHeight=n))},t.prototype.start=function(){if(this.frame)return;this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var e=function(){this.frame=t.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var t=new Date(0),n=this.seriesSet.reduce(function(e,t){var o,s=t.timeSeries.data,n=Math.round(this.options.displayDataFromPercentile*s.length)-1,n=n>=0?n:0,n=n<=s.length-1?n:s.length-1;return s&&s.length>0&&(o=s[n][0],e=e>o?e:o),e}.bind(this),t);this.render(this.canvas,n>t?n:null)}else this.render();e()}.bind(this))}.bind(this);e()},t.prototype.stop=function(){this.frame&&(t.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},t.prototype.updateValueRange=function(){for(var s,i,a,r,c,n=this.options,t=Number.NaN,e=Number.NaN,o=0;o<this.seriesSet.length;o++){if(s=this.seriesSet[o].timeSeries,s.disabled)continue;isNaN(s.maxValue)||(t=isNaN(t)?s.maxValue:Math.max(t,s.maxValue)),isNaN(s.minValue)||(e=isNaN(e)?s.minValue:Math.min(e,s.minValue))}n.maxValue!=null?t=n.maxValue:t*=n.maxValueScale,n.minValue!=null?e=n.minValue:e-=Math.abs(e*n.minValueScale-e),this.options.yRangeFunction&&(i=this.options.yRangeFunction({min:e,max:t}),e=i.min,t=i.max),!isNaN(t)&&!isNaN(e)&&(c=t-e,a=c-this.currentValueRange,r=e-this.currentVisMinValue,this.isAnimatingScale=(a<0?-a:a)>.1||(r<0?-r:r)>.1,this.currentValueRange+=n.scaleSmoothing*a,this.currentVisMinValue+=n.scaleSmoothing*r),this.valueRange={min:e,max:t}},t.prototype.render=function(e,t){if(o=this.options,m=Date.now(),o.limitFPS>0&&m-this.lastRenderTimeMillis<1e3/o.limitFPS)return;if(t=(t||m)-(this.delay||0),t-=t%o.millisPerPixel,!this.isAnimatingScale&&(H=this.lastChartTimestamp===t,H&&(W=m-this.lastRenderTimeMillis>1e3/6,!W)))return;this.lastRenderTimeMillis=m,this.lastChartTimestamp=t,this.resize(),e=e||this.canvas;var o,a,c,l,d,u,h,m,p,j,y,_,O,x,M,D,H,I,B,W,s=e.getContext("2d"),i={top:0,left:0,width:this.clientWidth,height:this.clientHeight},F=t-i.width*o.millisPerPixel,w=function(e,t){var s=e-this.currentVisMinValue,o=this.currentValueRange===0?i.height:i.height*(1-s/this.currentValueRange);return n.pixelSnap(o,t)}.bind(this),g=function(e,s){var a=t/o.millisPerPixel-e/o.millisPerPixel,r=o.scrollBackwards?a:i.width-a;return n.pixelSnap(r,s)};if(this.updateValueRange(),s.font=o.labels.fontSize+"px "+o.labels.fontFamily,s.save(),s.translate(i.left,i.top),s.beginPath(),s.rect(0,0,i.width,i.height),s.clip(),s.save(),s.fillStyle=o.grid.fillStyle,s.clearRect(0,0,i.width,i.height),s.fillRect(0,0,i.width,i.height),s.restore(),s.save(),s.lineWidth=o.grid.lineWidth,s.strokeStyle=o.grid.strokeStyle,o.grid.millisPerLine>0){s.beginPath();for(l=t-t%o.grid.millisPerLine;l>=F;l-=o.grid.millisPerLine)a=g(l,o.grid.lineWidth),s.moveTo(a,0),s.lineTo(a,i.height);s.stroke()}for(d=1;d<o.grid.verticalSections;d++)p=n.pixelSnap(d*i.height/o.grid.verticalSections,o.grid.lineWidth),s.beginPath(),s.moveTo(0,p),s.lineTo(i.width,p),s.stroke();if(o.grid.borderVisible&&s.strokeRect(0,0,i.width,i.height),s.restore(),o.horizontalLines&&o.horizontalLines.length)for(y=0;y<o.horizontalLines.length;y++){var C=o.horizontalLines[y],K=C.lineWidth||1,U=w(C.value,K);s.strokeStyle=C.color||"#ffffff",s.lineWidth=K,s.beginPath(),s.moveTo(0,U),s.lineTo(i.width,U),s.stroke()}for(h=0;h<this.seriesSet.length;h++){if(_=this.seriesSet[h].timeSeries,u=_.data,_.dropOldData(F,o.maxDataSetLength),u.length<=1||_.disabled)continue;s.save();var r=this.seriesSet[h].options,$=r.strokeStyle&&r.strokeStyle!=="none",f=$?r.lineWidth:0;s.beginPath();var v,E=g(u[0][0],f),z=w(u[0][1],f),A=E,P=z;switch(s.moveTo(E,z),r.interpolation||o.interpolation){case"linear":case"line":{v=function(e,t){s.lineTo(e,t)};break}case"bezier":default:{v=function(e,t,n,o){s.bezierCurveTo(Math.round((n+e)/2),o,Math.round(n+e)/2,t,e,t)};break}case"step":{v=function(e,t,n,o){s.lineTo(e,o),s.lineTo(e,t)};break}}for(O=1;O<u.length;O++){var L=u[O],N=g(L[0],f),V=w(L[1],f);v(N,V,A,P),A=N,P=V}$&&(s.lineWidth=r.lineWidth,s.strokeStyle=r.strokeStyle,s.stroke()),r.fillStyle&&(M=r.fillToBottom?i.height+f+1:w(0,0),s.lineTo(A,M),s.lineTo(E,M),s.fillStyle=r.fillStyle,s.fill()),s.restore()}if(o.tooltip&&this.mouseX>=0&&(s.lineWidth=o.tooltipLine.lineWidth,s.strokeStyle=o.tooltipLine.strokeStyle,s.beginPath(),s.moveTo(this.mouseX,0),s.lineTo(this.mouseX,i.height),s.stroke()),this.updateTooltip(),c=o.labels,!c.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var R=o.yMaxFormatter(this.valueRange.max,c.precision),b=o.yMinFormatter(this.valueRange.min,c.precision),X=o.scrollBackwards?0:i.width-s.measureText(R).width-2,G=o.scrollBackwards?0:i.width-s.measureText(b).width-2;s.fillStyle=c.fillStyle,s.fillText(R,X,c.fontSize),s.fillText(b,G,i.height-2)}if(c.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&o.grid.verticalSections>0)for(B=(this.valueRange.max-this.valueRange.min)/o.grid.verticalSections,D=i.height/o.grid.verticalSections,d=1;d<o.grid.verticalSections;d++){var p=i.height-Math.round(d*D),k=o.yIntermediateFormatter(this.valueRange.min+d*B,c.precision),Y=c.intermediateLabelSameAxis?o.scrollBackwards?0:i.width-s.measureText(k).width-2:o.scrollBackwards?i.width-s.measureText(k).width-2:0;s.fillText(k,Y,p-o.grid.lineWidth)}if(o.timestampFormatter&&o.grid.millisPerLine>0)for(j=o.scrollBackwards?s.measureText(b).width:i.width-s.measureText(b).width+4,l=t-t%o.grid.millisPerLine;l>=F;l-=o.grid.millisPerLine)if(a=g(l,0),!o.scrollBackwards&&a<j||o.scrollBackwards&&a>j){var q=new Date(l),S=o.timestampFormatter(q),T=s.measureText(S).width;j=o.scrollBackwards?a+T+2:a-T-2,s.fillStyle=o.labels.fillStyle,o.scrollBackwards?s.fillText(S,a,i.height-2):s.fillText(S,a-T,i.height-2)}o.title.text!==""&&(s.font=o.title.fontSize+"px "+o.title.fontFamily,I=o.scrollBackwards?i.width-s.measureText(o.title.text).width-2:2,o.title.verticalAlign=="bottom"?(s.textBaseline="bottom",x=i.height):o.title.verticalAlign=="middle"?(s.textBaseline="middle",x=i.height/2):(s.textBaseline="top",x=0),s.fillStyle=o.title.fillStyle,s.fillText(o.title.text,I,x)),s.restore()},t.timeFormatter=function(e){function t(e){return(e<10?"0":"")+e}return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},e.TimeSeries=s,e.SmoothieChart=t})(typeof exports=="undefined"?this:exports)